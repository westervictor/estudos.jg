================================================================================
DOCUMENTA√á√ÉO DAS CORRE√á√ïES REALIZADAS NO ARQUIVO products/admin.py
================================================================================

Data: 25/12/2025
Arquivo: products/admin.py

================================================================================
CORRE√á√ÉO 1: Erro com caractere % em descri√ß√£o de a√ß√£o
================================================================================

ERRO:
TypeError: %d format: a real number is required, not dict
Exception Location: django/contrib/admin/options.py, line 1055, in get_action_choices

DESCRI√á√ÉO DO PROBLEMA:
O Django admin tenta formatar as descri√ß√µes de a√ß√µes usando um dicion√°rio.
Quando a descri√ß√£o cont√©m o caractere %, ele √© interpretado como especificador
de formato, causando erro.

LINHA: 90

C√ìDIGO ANTES (ERRADO):
    apply_discount_10.short_description = 'Aplicar 10% de desconto'

C√ìDIGO DEPOIS (CORRETO):
    apply_discount_10.short_description = 'Aplicar 10%% de desconto'

EXPLICA√á√ÉO:
O caractere % precisa ser escapado como %% para ser tratado como literal
ao inv√©s de especificador de formato pelo Django.

================================================================================
CORRE√á√ÉO 2: format_html sem argumentos - stock_badge (linha 316-318)
================================================================================

ERRO:
TypeError: args or kwargs must be provided.
Exception Location: django/utils/html.py, line 137, in format_html

DESCRI√á√ÉO DO PROBLEMA:
A fun√ß√£o format_html requer pelo menos um argumento al√©m da string de formato.
Quando a string HTML n√£o tem placeholders ({}), deve-se usar mark_safe.

LINHA: 316-318

C√ìDIGO ANTES (ERRADO):
    def stock_badge(self, obj):
        if not obj.manage_stock:
            return format_html(
                '<span class="badge" style="background:#17a2b8;color:white;padding:2px 8px;border-radius:10px">NC</span>'
            )

C√ìDIGO DEPOIS (CORRETO):
    def stock_badge(self, obj):
        if not obj.manage_stock:
            return mark_safe(
                '<span class="badge" style="background:#17a2b8;color:white;padding:2px 8px;border-radius:10px">NC</span>'
            )

EXPLICA√á√ÉO:
Para HTML est√°tico sem necessidade de formata√ß√£o, use mark_safe ao inv√©s de
format_html.

================================================================================
CORRE√á√ÉO 3: format_html sem argumentos - stock_badge (linha 321-323)
================================================================================

ERRO:
TypeError: args or kwargs must be provided.
Exception Location: django/utils/html.py, line 137, in format_html

LINHA: 321-323

C√ìDIGO ANTES (ERRADO):
        if obj.stock_quantity <= 0:
            return format_html(
                '<span class="badge" style="background:#dc3545;color:white;padding:2px 8px;border-radius:10px">Esgotado</span>'
            )

C√ìDIGO DEPOIS (CORRETO):
        if obj.stock_quantity <= 0:
            return mark_safe(
                '<span class="badge" style="background:#dc3545;color:white;padding:2px 8px;border-radius:10px">Esgotado</span>'
            )

EXPLICA√á√ÉO:
Mesmo caso da corre√ß√£o anterior - HTML est√°tico deve usar mark_safe.

================================================================================
CORRE√á√ÉO 4: format_html sem argumentos - has_promotion_badge
================================================================================

ERRO:
TypeError: args or kwargs must be provided.
Exception Location: django/utils/html.py, line 137, in format_html

LINHA: 401-405

C√ìDIGO ANTES (ERRADO):
    def has_promotion_badge(self, obj):
        if obj.has_promotion:
            return format_html(
                '<span class="badge" style="background:#28a745;color:white;padding:4px 10px;border-radius:12px">'
                'üéØ PROMO√á√ÉO ATIVA'
                '</span>'
            )
        return '-'

C√ìDIGO DEPOIS (CORRETO):
    def has_promotion_badge(self, obj):
        if obj.has_promotion:
            return mark_safe(
                '<span class="badge" style="background:#28a745;color:white;padding:4px 10px;border-radius:12px">'
                'üéØ PROMO√á√ÉO ATIVA'
                '</span>'
            )
        return '-'

EXPLICA√á√ÉO:
HTML est√°tico sem placeholders deve usar mark_safe.

================================================================================
CORRE√á√ÉO 5: format_html sem argumentos - status_badge (PromotionAdmin)
================================================================================

ERRO:
TypeError: args or kwargs must be provided.
Exception Location: django/utils/html.py, line 137, in format_html

LINHA: 701-711

C√ìDIGO ANTES (ERRADO):
    def status_badge(self, obj):
        if obj.is_active:
            return format_html(
                '<span class="badge" style="background:#28a745;color:white;padding:2px 8px;border-radius:10px">'
                'ATIVA'
                '</span>'
            )
        else:
            return format_html(
                '<span class="badge" style="background:#6c757d;color:white;padding:2px 8px;border-radius:10px">'
                'INATIVA'
                '</span>'
            )

C√ìDIGO DEPOIS (CORRETO):
    def status_badge(self, obj):
        if obj.is_active:
            return mark_safe(
                '<span class="badge" style="background:#28a745;color:white;padding:2px 8px;border-radius:10px">'
                'ATIVA'
                '</span>'
            )
        else:
            return mark_safe(
                '<span class="badge" style="background:#6c757d;color:white;padding:2px 8px;border-radius:10px">'
                'INATIVA'
                '</span>'
            )

EXPLICA√á√ÉO:
Ambos os retornos de HTML est√°tico foram corrigidos para usar mark_safe.

================================================================================
CORRE√á√ÉO 6: format_html sem argumentos - status_display (PromotionAdmin)
================================================================================

ERRO:
TypeError: args or kwargs must be provided.
Exception Location: django/utils/html.py, line 137, in format_html

LINHA: 769

C√ìDIGO ANTES (ERRADO):
        else:
            return format_html('<span style="color:#dc3545">‚ùå Inativa</span>')

C√ìDIGO DEPOIS (CORRETO):
        else:
            return mark_safe('<span style="color:#dc3545">‚ùå Inativa</span>')

EXPLICA√á√ÉO:
HTML est√°tico sem placeholders deve usar mark_safe.

================================================================================
CORRE√á√ÉO 7: Especificador de formato em format_html - profit_margin_display
================================================================================

ERRO:
ValueError: Unknown format code 'f' for object of type 'SafeString'
Exception Location: django/utils/html.py, line 140, in format_html

DESCRI√á√ÉO DO PROBLEMA:
O format_html do Django n√£o aceita especificadores de formato como {:.1f}
diretamente na string de template. √â necess√°rio formatar o valor antes.

LINHA: 356-365

C√ìDIGO ANTES (ERRADO):
    def profit_margin_display(self, obj):
        margin = obj.profit_margin
        if margin is None:
            return '-'
        color = 'green' if margin > 30 else 'orange' if margin > 15 else 'red'
        return format_html(
            '<span style="color:{};font-weight:bold">{:.1f}%</span>',
            color, margin
        )

C√ìDIGO DEPOIS (CORRETO):
    def profit_margin_display(self, obj):
        margin = obj.profit_margin
        if margin is None:
            return '-'
        color = 'green' if margin > 30 else 'orange' if margin > 15 else 'red'
        margin_formatted = f'{margin:.1f}'
        return format_html(
            '<span style="color:{};font-weight:bold">{}%</span>',
            color, margin_formatted
        )

EXPLICA√á√ÉO:
O valor num√©rico foi formatado ANTES de ser passado para format_html.
Usamos f-string para formatar o margin com 1 casa decimal, e depois passamos
o valor j√° formatado como string para o format_html.

================================================================================
RESUMO DAS CORRE√á√ïES
================================================================================

1. Linha 90: Escapamento de % em descri√ß√£o de a√ß√£o (10% ‚Üí 10%%)

2. Linha 316-318: Troca de format_html por mark_safe (stock_badge - caso NC)

3. Linha 321-323: Troca de format_html por mark_safe (stock_badge - caso Esgotado)

4. Linha 401-405: Troca de format_html por mark_safe (has_promotion_badge)

5. Linha 701-711: Troca de format_html por mark_safe (status_badge PromotionAdmin)

6. Linha 769: Troca de format_html por mark_safe (status_display PromotionAdmin)

7. Linha 356-365: Formata√ß√£o num√©rica antes de format_html (profit_margin_display)

================================================================================
REGRAS GERAIS APLICADAS
================================================================================

1. Para HTML est√°tico (sem placeholders {}), use mark_safe() ao inv√©s de format_html()

2. Para strings com caractere % em descri√ß√µes de a√ß√µes, escapar como %%

3. Para formata√ß√£o num√©rica em format_html, formatar o valor antes de passar

4. format_html() deve ser usado apenas quando h√° placeholders {} na string HTML

================================================================================
FIM DO DOCUMENTO
================================================================================

